---
# tasks file for preconf_centos
- name: Upgrade all packages
  yum:
    name: '*'
    state: latest
  when: upgrade_all

- name: EPEL install
  yum: 
    name: epel-release 
    state: latest
  when: install_epel
    
- name: Install start soft
  yum: 
    name: "{{ packages }}"
    state: installed
  vars:
    packages:
    - vim
    - net-tools
    - bind-utils
    - rsync
    - wget
    - pwgen
    - screen
    - git
    - zip
    - unzip
    - iotop
    - jnettop
    - psmisc
  when: start_soft and install_epel

- name: Init firewalld
  systemd:
    name: firewalld
    enabled: yes
    state: started
  when: init_firewalld

- name: Change hostname system-wide
  hostname:
    name: '{{ hostname }}'
  when: change_hostname

- name: Change hostname in sysctl
  sysctl:
    name: kernel.hostname
    value: '{{ hostname }}'
    sysctl_file: /etc/sysctl.conf
    reload: yes
  when: change_hostname

- name: Disable IPv6 in sysctl
  sysctl:
    name: '{{ item.name }}'
    value: '{{ item.value }}'
    sysctl_file: /etc/sysctl.conf
    reload: yes
  with_items:
    - { name: 'net.ipv6.conf.all.disable_ipv6', value: '1' }
    - { name: 'net.ipv6.conf.all.autoconf', value: '0' }
  when: disable_ipv6